<h2>Project Euler</h2>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/default.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js"></script>
<script type="text/javascript" async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
<p> 
	I decided to learn Go! I felt a good way to learn would be to tackle some of the <a href="https://projecteuler.net/">Project Euler</a> problems. I also
	took the opportunity to learn how to call these functions from Python.
</p>
<p>
	The buttons highlighted in green in the table below represent the problems I have completed. Clicking them will display my code, together with a button which will
	(asynchronously) run the code in real time, and display the answer.
</p> 
<p>
	Unfortunately, I haven't yet thought up a good way to recursively expand my go imports to show the library functions I'm using. When I have a good idea, I'll implement that
	at a future date.
</p>

<table style="width: 100%">
{% for i in range(10) %}
	<tr>
	{% for j in range(1, 11) %}
		{% set cellNumber=10*i + j %}
		<td>
			{% if cellNumber in solvedProblemNumbers %}
			<button class="requestExercise{{cellNumber}}", style="width: 100%; background-color: #51d14b">
				{{cellNumber}}
			</button>
			{% else %}
			<button class="requestExercise{{cellNumber}}", style="width: 100%; background-color: #d14b4b">
				{{cellNumber}}
			</button>
			{% endif %}
		</td>
	{% endfor %}
	</tr>
{% endfor %}
</table>

<div style="width: 100%">
	<h3 class="exerciseTitle"></h3>
	<div class="exerciseDescription"></div>
	<div class="solutionDiv" style="display: none">
		<h3>Solution</h3>
		<button class="runCode">Run Code!</button>
		<h4 class="solution"></h4>
	</div>
	<pre><code class="go"><div class="exerciseSource" style="width: 100%"></div></code></pre>
</div>

{% for problem in solvedProblems %}
		<script type="module">
			
			const requestButton{{problem.number}} = document.querySelector('.requestExercise{{problem.number}}');
			
			window.jimActiveDisplaySolutionFunction = null;

			let displayCode = async function ()
			{
				const source = document.querySelector('.exerciseSource');
				const title = document.querySelector('.exerciseTitle');
				const description = document.querySelector('.exerciseDescription');
				const solution = document.querySelector('.solution');
				const runCodeButton = document.querySelector('.runCode');
				const solutionDiv = document.querySelector('.solutionDiv')

				window.jimActiveProblem = {{problem.number}}
				if (window.jimActiveDisplaySolutionFunction !== null) runCodeButton.removeEventListener('click', window.jimActiveDisplaySolutionFunction)
				
				//remove event listeners
				runCodeButton

				solutionDiv.style.display = "block";

				solution.innerText = ""

				title.innerText = "Problem {{ problem.number }} - {{problem.name}}";
				description.innerHTML = "{{ problem.description|safe }}";

				let response = await fetch("/project_euler_solution_code/" + {{ problem.number }});
				source.innerText = await response.text();
				document.querySelectorAll('pre code').forEach((block) => {
					hljs.highlightBlock(block);
				});

				let displayAnswer = async function ()
				{
					solution.innerText = ""
					
					solution.innerText = "Calculating"
					
					const xmlRequest = new XMLHttpRequest();
					await xmlRequest.open("GET", "/project_euler_solution/"  + {{ problem.number }}, true);
					await xmlRequest.send()

					async function waitForAnswer() {
						return await new Promise(resolve => {
							let i = 0;
							const interval = setInterval(() => {
								// Animation for ellipses
								solution.innerText = "Calculating" + Array.from({ length: i%4 }).fill('.').join('')
								if (xmlRequest.readyState === XMLHttpRequest.DONE && xmlRequest.responseText !== '1') {
									resolve();
									clearInterval(interval);
								};
								i++;
							}, 500);
						});
					}

					await waitForAnswer()

					let responses = xmlRequest.responseText.split('\n')
					solution.innerText = responses[responses.length - 1]

				
				}

				runCodeButton.addEventListener('click', displayAnswer);
				window.jimActiveDisplaySolutionFunction = displayAnswer;
				MathJax.Hub.Queue(["Typeset", MathJax.Hub]);

			}

			requestButton{{problem.number}}.addEventListener('click', displayCode);

		</script>
{% endfor %}
